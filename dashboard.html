<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MySa Jewelry - Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .container { max-width: 900px; }
    .card { border-radius: 15px; }
    .product-img { height: 200px; object-fit: cover; border-radius: 10px; }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      border-radius: 8px;
      color: #fff;
      display: none;
      z-index: 1000;
    }
    .notification.success { background: #28a745; }
    .notification.error { background: #dc3545; }
  </style>
</head>
<body>
  <!-- Login Modal -->
  <div class="modal" tabindex="-1" id="loginModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Admin Login</h5>
        </div>
        <div class="modal-body">
          <input type="password" id="adminPassword" class="form-control" placeholder="Enter admin password" autofocus>
          <div id="loginError" class="text-danger mt-2" style="display:none;">Incorrect password. Try again.</div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="loginBtn">Login</button>
        </div>
      </div>
    </div>
  </div>
  <div class="container py-4">
    <div class="text-end mb-3">
      <button id="logoutBtn" class="btn btn-outline-danger btn-sm" style="display:none;">Logout</button>
    </div>
    <h2 class="text-center mb-4">MySa Jewelry - Admin Panel</h2>

    <!-- Product Form -->
    <div class="card shadow p-4 mb-4">
      <h4>Add Product</h4>
      <form id="productForm">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Product Name</label>
            <input type="text" id="productName" class="form-control" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Price (₹)</label>
            <input type="number" id="productPrice" class="form-control" required>
          </div>

          <!-- Product Type -->
          <div class="col-md-6 mb-3">
            <label for="productType" class="form-label">Product Type</label>
            <select class="form-control" id="productType" required>
              <option value="">Select Type</option>
              <option value="Earrings">Earrings</option>
              <option value="Necklaces">Necklaces</option>
              <option value="Gift Hampers">Gift Hampers</option>
              <option value="Candles">Candles</option>
              <option value="Bookmarks">Bookmarks</option>
              <option value="Fridge Magnets">Fridge Magnets</option>
            </select>
          </div>

          <div class="col-md-12 mb-3">
            <label class="form-label">Description</label>
            <textarea id="productDescription" class="form-control" rows="2"></textarea>
          </div>
          <div class="col-md-12 mb-3">
            <label class="form-label">Product Image</label>
            <input type="file" id="productImage" class="form-control" accept="image/*" required>
            <div id="imagePreview" class="mt-2" style="display:none;">
              <img id="previewImg" class="product-img" />
            </div>
          </div>
        </div>
        <button type="submit" class="btn btn-primary">Add Product</button>
      </form>
    </div>

    <!-- Product List -->
    <div class="card shadow p-4">
      <h4>Product List</h4>
      <div id="productList" class="row g-3"></div>
    </div>
  </div>

  <div id="notification" class="notification"></div>

  <script>
    // --- Simple Login/Logout System ---
    const ADMIN_KEY = "mysa2025admin";
    const loginModal = document.getElementById('loginModal');
    const logoutBtn = document.getElementById('logoutBtn');
    function showLoginModal() {
      loginModal.style.display = 'block';
      loginModal.classList.add('show');
      document.body.classList.add('modal-open');
    }
    function hideLoginModal() {
      loginModal.style.display = 'none';
      loginModal.classList.remove('show');
      document.body.classList.remove('modal-open');
    }
    function checkLogin() {
      if (localStorage.getItem('mysa_admin_logged_in') === 'true') {
        logoutBtn.style.display = 'inline-block';
        return true;
      } else {
        showLoginModal();
        return false;
      }
    }
    document.getElementById('loginBtn').onclick = function() {
      const pw = document.getElementById('adminPassword').value;
      if (pw === ADMIN_KEY) {
        localStorage.setItem('mysa_admin_logged_in', 'true');
        hideLoginModal();
        logoutBtn.style.display = 'inline-block';
        document.getElementById('loginError').style.display = 'none';
        document.querySelector('.container').style.display = '';
      } else {
        document.getElementById('loginError').style.display = 'block';
      }
    };
    logoutBtn.onclick = function() {
      localStorage.removeItem('mysa_admin_logged_in');
      location.reload();
    };
    // Show login modal if not logged in
    window.addEventListener('DOMContentLoaded', function() {
      checkLogin();
    });
    // Prevent interaction with dashboard if not logged in
    document.addEventListener('DOMContentLoaded', function() {
      if (!checkLogin()) {
        document.querySelector('.container').style.display = 'none';
      } else {
        document.querySelector('.container').style.display = '';
      }
    });
    const form = document.getElementById('productForm');
    const productList = document.getElementById('productList');
    const notification = document.getElementById('notification');

    // ✅ Your Cloudinary Details
    const CLOUD_NAME = "dy3a1bjpp";
    const UPLOAD_PRESET = "mysa_unsigned";

    // Show notification
    function showNotification(message, type = 'success') {
      notification.textContent = message;
      notification.className = 'notification ' + type;
      notification.style.display = 'block';
      setTimeout(() => notification.style.display = 'none', 3000);
    }

    // Load products
    function loadProducts() {
      productList.innerHTML = '';
      const products = JSON.parse(localStorage.getItem('products') || '[]');
      if (products.length === 0) {
        productList.innerHTML = '<p class="text-muted">No products added yet.</p>';
        return;
      }
      products.forEach(product => {
        const div = document.createElement('div');
        div.className = 'col-md-4';
        div.innerHTML = `
          <div class="card shadow-sm h-100 p-2">
            <img src="${product.image}" class="product-img mb-2" />
            <div class="card-body">
              <h5>${product.name}</h5>
              <p class="text-muted mb-1">₹${product.price}</p>
              <p class="badge bg-light text-dark">${product.type}</p>
              ${product.description ? `<p class="small text-muted">${product.description}</p>` : ''}
              <small class="text-muted">ID: ${product.id}</small>
              <button class="btn btn-danger btn-sm mt-2 delete-product" data-id="${product.id}">Delete</button>
            </div>
          </div>
        `;
        productList.appendChild(div);
      });
      // Add event listeners for delete buttons
      document.querySelectorAll('.delete-product').forEach(btn => {
        btn.addEventListener('click', function() {
          const id = this.getAttribute('data-id');
          deleteProduct(id);
        });
      });
    // Delete product by ID
    function deleteProduct(id) {
      let products = JSON.parse(localStorage.getItem('products') || '[]');
      products = products.filter(product => product.id != id);
      localStorage.setItem('products', JSON.stringify(products));
      loadProducts();
      showNotification('Product deleted!', 'success');
    }
    }

    // Form submit
    form.addEventListener('submit', async function (e) {
      e.preventDefault();

      const name = document.getElementById('productName').value;
      const price = document.getElementById('productPrice').value;
      const description = document.getElementById('productDescription').value;
      const type = document.getElementById('productType').value;
      const imageFile = document.getElementById('productImage').files[0];

      if (!imageFile) {
        showNotification('Please select an image!', 'error');
        return;
      }

      try {
        // Upload image to Cloudinary
        const formData = new FormData();
        formData.append("file", imageFile);
        formData.append("upload_preset", UPLOAD_PRESET);

  const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
          method: "POST",
          body: formData
        });

        const data = await res.json();

        if (!data.secure_url) throw new Error("Image upload failed");

        const product = {
          id: Date.now(),
          name,
          price: parseInt(price),
          description,
          type,
          image: data.secure_url // ✅ permanent Cloudinary URL
        };

        let products = JSON.parse(localStorage.getItem('products') || '[]');
        products.push(product);
        localStorage.setItem('products', JSON.stringify(products));

        form.reset();
        document.getElementById('imagePreview').style.display = 'none';
        document.getElementById('previewImg').src = '';

        loadProducts();
        showNotification('Product added successfully!');
      } catch (err) {
        console.error(err);
        showNotification('Error uploading image!', 'error');
      }
    });

    // Image preview
    document.getElementById('productImage').addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        document.getElementById('previewImg').src = URL.createObjectURL(file);
        document.getElementById('imagePreview').style.display = 'block';
      }
    });

    // Initial load
    loadProducts();
  </script>
</body>
</html>
